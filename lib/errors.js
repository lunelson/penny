//   ___ _ __ _ __
//  / _ \ '__| '__|
// |  __/ |  | |
//  \___|_|  |_|

const cssEsc = require('cssesc');

const logoRules = {
  pug: 'data:image/svg+xml;charset=UTF-8,%3csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 129 80"%3e%3cg fill="none" fill-rule="nonzero"%3e%3cpath fill="%23EFCCA3" d="M107.4 24.9c-.2-4.4.4-8.3-1.6-11.6C101 5.1 89 .3 65 .3V1h-.5.5V.3c-24 0-36.6 4.8-41.4 13.1-1.9 3.4-1.7 7.2-2 11.6-.2 3.5-1.8 7.2-1.1 11.2.8 5.2 1.1 10.4 1.9 15.2.6 3.9 6 7.2 6.5 10.9 1.4 10.2 12 14.9 36 14.9v.8h-.6.7v-.8c24 0 34.2-4.7 35.5-14.9.5-3.8 5.5-7 6.1-10.9.8-4.8 1.1-10 1.9-15.2.7-4-.9-7.8-1.1-11.3z"/%3e%3cpath fill="%23CCAC8D" d="M64.6 28.5c4.3.1 7.3 2.8 10.1 5.3 3.3 2.9 8.9 4.9 11.2 7.4 2.3 2.5 5.3 5 6.4 8.9 1.1 3.9 1.4 8.9 1.4 10.2 0 1.3.7 1 2.7 0 4.7-2.3 9.9-8.5 9.9-8.5-.6 3.9-5.7 7.4-6.2 11.1C98.9 73.1 89 78 64.5 78h-.1.6"/%3e%3cpath fill="%23CCAC8D" d="M80.4 20.7c.9 3.1 4.1 13.6-2.1 10.1 0 0 2.6 1.5 4.2 7.2 1.7 5.7 5.8 6.4 5.8 6.4s6.7 1.3 11.7-3c4.2-3.6 4.9-10 3.1-14.9-1.8-4.8-5-6.3-9.7-7.3-4.7-1.1-14.1-2-13 1.5z"/%3e%3ccircle cx="92.3" cy="32.1" r="8.8" fill="%23000"/%3e%3ccircle cx="90" cy="28.2" r="2.3" fill="%23FFF"/%3e%3cpath fill="%23EFCCA3" d="M78.9 31.7s7.9 5.4 12.2 10.7c4.3 5.3 4.2 6.3 4.2 6.3l-3.1 1.4s-4.4-8.3-9.8-11.4c-5.5-3.1-6.1-5.7-6.1-5.7l2.6-1.3z"/%3e%3cpath fill="%23CCAC8D" d="M64.9 28.5c-4.3.1-7.5 2.8-10.4 5.3-3.3 2.9-9.1 4.9-11.4 7.4-2.3 2.5-5.4 5-6.5 8.9-1.1 3.9-1.5 8.9-1.5 10.2 0 1.3.2 1.4-2.7 0-4.7-2.2-9.9-8.5-9.9-8.5.6 3.9 5.7 7.4 6.2 11.1C30.1 73.1 40 78 64.5 78h.5"/%3e%3cpath fill="%2356332B" d="M88.1 45.4C83.3 39.5 75.6 34 64.9 34h-.1c-10.7 0-18.4 5.5-23.2 11.4-5 6.1-4.6 8.5-4.6 14.3 0 21 7.4 15 12.3 17.6 5 2.5 10.2 1.7 15.5 1.7h.1c5.4 0 10.5.7 15.5-1.8 4.9-2.5 12.3 3.7 12.3-17.3.1-5.8.4-8.4-4.6-14.5z"/%3e%3cpath fill="%23442823" d="M64.4 39.2s-.7 9.7-2.1 11.6l2.6-.6-.5-11z"/%3e%3cpath fill="%23442823" d="M65.1 39.2s.7 9.7 2.1 11.6l-2.6-.6.5-11z"/%3e%3cpath fill="%2356332B" d="M56.7 36.9c-1-2.3 2.6-6 8.3-6.1 5.7 0 9.3 3.7 8.3 6.1-1 2.4-4.6 3.1-8.3 3.2-3.6-.1-7.3-.8-8.3-3.2z"/%3e%3cpath fill="%23000" d="M65 39.2c0-.4 3.4-.5 5.2-1.7 0 0-3.7 1.2-4.5.7-.8-.4-1-1.6-1-1.6s-.3 1.2-.9 1.6c-.7.4-4.9-.7-4.9-.7s5.6 1.4 5.6 1.7c0 .3-.1 1.3-.1 2 0 2.5 0 8.7.4 9.2.6.9.4-6.7.4-9.2-.1-.8-.1-1.6-.2-2z"/%3e%3cpath fill="%237F4A41" d="M65.2 52.6c1.7 0 4.7 1.2 7.4 3.1-2.6-2.9-5.7-4.9-7.4-4.9-1.8 0-5.6 2.2-8.3 5.4 2.8-2.2 6.4-3.6 8.3-3.6z"/%3e%3cpath fill="%23442823" d="M64.5 70.3c-3.8 0-7.5-1.2-10.9-2.1-.7-.2-1.4.3-2.1.1-6.3-2-11.4-5.4-14.5-9.7v1c0 21 7.4 15.1 12.3 17.6 5 2.5 10.2 1.7 15.5 1.7h.1c5.4 0 10.5.7 15.5-1.8 4.9-2.5 12.3 3.6 12.3-17.4 0-.8 0-1.6.1-2.3-2.9 4.7-8.2 8.4-14.8 10.6-.6.2-2-.3-2.6-.2-3.6 1.2-6.8 2.5-10.9 2.5z"/%3e%3cpath fill="%23442823" d="M55 59s-2.5 7.5-.8 10.8l-2.3-1s1.7-7.6 3.1-9.8zm19.8 0s2.5 7.5.8 10.8l2.3-1s-1.8-7.6-3.1-9.8z"/%3e%3cpath fill="%23CCAC8D" d="M48.6 20.7c-.9 3.1-4.1 13.6 2.1 10.1 0 0-2.6 1.5-4.2 7.2s-5.8 6.4-5.8 6.4-6.7 1.3-11.7-3c-4.2-3.6-4.9-10-3.1-14.9 1.8-4.9 5-6.3 9.7-7.3 4.7-1.1 14-2 13 1.5z"/%3e%3cpath fill="%23000" d="M64.9 50.8c2.7 0 11.1 5.8 11.2 12.9v-.4c0-7.4-6.8-13.3-11.2-13.3-4.4 0-11.2 6-11.2 13.3v.4c.1-7.1 8.5-12.9 11.2-12.9z"/%3e%3cellipse cx="66.70837" cy="35.50198" fill="%23331712" transform="rotate(-14.465 66.708 35.502)" rx="1" ry="1.5"/%3e%3cellipse cx="62.38739" cy="35.50718" fill="%23331712" transform="rotate(17.235 62.387 35.507)" rx="1" ry="1.5"/%3e%3ccircle cx="37.2" cy="32.1" r="8.8" fill="%23000"/%3e%3ccircle cx="39.5" cy="28.2" r="2.3" fill="%23FFF"/%3e%3cpath fill="%237F4A41" d="M67.5 32.2c0-.1-2.3 1-2.9 1.1-.6-.1-2.9-1.2-2.9-1.1h5.8z"/%3e%3cpath fill="%23EFCCA3" d="M50 31.7s-7.9 5.4-12.2 10.7c-4.3 5.3-4.2 6.3-4.2 6.3l3.1 1.4s4.4-8.3 9.8-11.4c5.4-3.1 6.1-5.7 6.1-5.7L50 31.7z"/%3e%3cpath fill="%23CCAC8D" d="M32.7 15.7S30 23.1 24 26.2c0 0 9.4-1.1 8.7-10.5zm63.1 0s2.7 7.4 8.7 10.5c0 0-9.4-1.1-8.7-10.5zM78.7 29.5s-5.9-6.2-13.8-6.4h.2c-8 .2-13.8 6.4-13.8 6.4 6.9-4.8 12.8-4.7 13.8-4.7-.1 0 6.7-.1 13.6 4.7zm-6.9-13s-3-4.2-7-4.3h.2c-3 .1-6.9 4.3-6.9 4.3 3.4-3.3 6.9-3.2 6.9-3.2s3.3-.1 6.8 3.2zM37.2 47.2s-4.7 2.3-8.1.9H29c-3-1.7-4.5-6.8-4.5-6.8s3 9 12.7 5.9zm54.8 0s4.7 2.3 8.1.9c4-1.7 4.6-6.8 4.6-6.8s-3 9-12.7 5.9z"/%3e%3cpath fill="%23CCAC8D" d="M42.6 15.2c2.6-.5 6.9-.6 10.3.5 4.3 1.5.8 7 1.7 7.3.9.3 2.1-3.8 10.1-3.4 8.1.4 9 4 10.1 3.4 1.1-.6-1.1-10 11-7.8 0 0-12.7-3.4-12.1 5.8 0 0-7.3-5.6-17.5-.6.1 0 2.7-8.6-13.6-5.2zm44.3 0c.2 0 .3.1.4.1.1 0-.1-.1-.4-.1zM39.1 2.9S28.3 16.5 26.7 21.7c-1.6 5.3-2.8 27-4.2 30.1l-5-21.4 9.2-22.3 12.4-5.2zm50.8 0s10.8 13.6 12.4 18.8c1.6 5.3 2.8 27 4.2 30.1l5-21.4-9.2-22.3-12.4-5.2z"/%3e%3cpath fill="%2356332B" d="M89.4 2.9s11.6 9.7 15 20.9c3.4 11.2 2 24.8 4.6 26.5 3.7 2.4 7.9-11.9 9.3-13.4 2.2-2.4 9.5-8.5 10-9.6.5-1.1-14.8-17.8-21.5-21.1-8.1-3.8-18.1-4.1-17.4-3.3z"/%3e%3cpath fill="%23442823" d="M99.3 8.9s13.7 17.5 13.5 39.3l5.5-11.2c-.1 0-4.9-14.3-19-28.1z"/%3e%3cpath fill="%2356332B" d="M39.1 2.9s-11.6 9.7-15 20.9c-3.4 11.2-2 24.8-4.6 26.5-3.7 2.4-7.9-11.9-9.3-13.4C8 34.5.7 28.4.2 27.3-.3 26.2 15 9.5 21.7 6.2c8.1-3.8 18.1-4.1 17.4-3.3z"/%3e%3cpath fill="%23442823" d="M29.2 8.9S15.5 26.4 15.7 48.2L10.3 37s4.8-14.3 18.9-28.1z"/%3e%3cpath fill="%23CCAC8D" d="M21.8 48.6s1 5.4 2.6 7.1c1.6 1.7.5-1.3.5-1.3s-1.7-.9-1.4-7.8c.3-6.9-1.7 2-1.7 2zm85.3 0s-1 5.4-2.6 7.1c-1.6 1.7-.5-1.3-.5-1.3s1.7-.9 1.4-7.8c-.3-6.9 1.7 2 1.7 2z"/%3e%3cg fill="%23442823" transform="translate(47 43)"%3e%3ccircle cx="7.5" cy="1.5" r="1"/%3e%3ccircle cx="2.9" cy="6.3" r="1"/%3e%3ccircle cx="1.4" cy="1.5" r="1"/%3e%3c/g%3e%3cg fill="%23442823" transform="translate(73 43)"%3e%3ccircle cx="1" cy="1.5" r="1"/%3e%3ccircle cx="5.6" cy="6.3" r="1"/%3e%3ccircle cx="7.1" cy="1.5" r="1"/%3e%3c/g%3e%3c/g%3e%3c/svg%3e',
  scss: 'data:image/svg+xml;charset=UTF-8,%3csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 411 411" xmlns:xlink="http://www.w3.org/1999/xlink"%3e%3cdefs%3e%3cpath id="a" d="M.06 411V.129h410.811V411z"/%3e%3c/defs%3e%3cg fill="none" fill-rule="evenodd"%3e%3cmask id="b" fill="%23fff"%3e%3cuse xlink:href="%23a"/%3e%3c/mask%3e%3cpath fill="%23BE5F8A" d="M205.436.129c113.459 0 205.435 91.977 205.435 205.436S318.895 411 205.436 411 0 319.024 0 205.565 91.977.129 205.436.129" mask="url(%23b)"/%3e%3cpath fill="%23FFFFFE" d="M164.609 273.996c2.989 11.056 2.661 21.366-.426 30.703-.343 1.037-.721 2.063-1.131 3.077-.41 1.012-.854 2.013-1.33 3.001-2.381 4.94-5.576 9.564-9.489 13.832-11.936 13.022-28.613 17.946-35.764 13.797-7.722-4.476-3.854-22.836 9.985-37.464 14.888-15.739 36.309-25.858 36.309-25.858l-.033-.064c.617-.332 1.244-.674 1.879-1.024zm169.69-185.938c-9.303-36.486-69.801-48.48-127.059-28.139-34.075 12.107-70.964 31.107-97.488 55.916-31.537 29.498-36.566 55.172-34.493 65.9 7.312 37.854 59.179 62.597 80.501 80.955v.111c-6.287 3.095-52.304 26.383-63.073 50.191-11.363 25.117 1.809 43.141 10.529 45.567 27.019 7.517 54.745-6.004 69.645-28.229 14.379-21.448 13.182-49.144 6.933-62.921 8.62-2.274 18.669-3.293 31.44-1.801 36.037 4.209 43.108 26.711 41.756 36.126-1.351 9.418-8.91 14.596-11.437 16.159-2.528 1.564-3.299 2.105-3.086 3.267.306 1.69 1.476 1.627 3.631 1.262 2.966-.5 18.923-7.66 19.605-25.043.869-22.07-20.281-46.758-57.73-46.113-15.423.266-25.121 1.733-32.126 4.34-.518-.59-1.045-1.177-1.59-1.758-23.152-24.701-65.951-42.174-64.136-75.381.66-12.072 4.856-43.861 82.239-82.42 63.39-31.587 114.136-22.895 122.906-3.631 12.527 27.521-27.121 78.673-92.952 86.051-25.081 2.812-38.287-6.909-41.572-10.529-3.459-3.811-3.974-3.983-5.265-3.268-2.104 1.165-.771 4.53 0 6.536 1.965 5.115 10.031 14.186 23.782 18.698 12.096 3.97 41.544 6.151 77.157-7.624 39.885-15.429 71.031-58.347 61.883-94.222z"/%3e%3c/g%3e%3c/svg%3e'
};

function errRule(message, bgcolor) {
  return `
  position: absolute;
  top: 0; left: 0;
  display: block;
  width: 100%;
  padding: 1rem;
  font-family: monospace;
  content: '${cssEsc(message, {isIdentifier: true, wrap: true, quotes: 'single'})}';
  white-space: pre-wrap;
  background-color: ${bgcolor};
  background-repeat: no-repeat;
  background-position: 2rem 1rem;
  background-size: 3rem;
  padding-left: 7rem;
  min-height: 3rem;
  `.replace(/\n/g,'');
}

function cssErr(message, bgcolor) {
  return `
  html { font-size: 1em; position: relative; }
  html:before { ${errRule(message, bgcolor)} background-image: url('${logoRules['scss']}'); }
  `.replace(/\n/g,'');
}

function htmlCssErr(message, bgcolor) {
  return `
  <!DOCTYPE html>
  <html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Error</title>
    <style>
      html { font-size: 1em; position: relative; }
      html:before { ${errRule(message, bgcolor)} background-image: url('${logoRules['pug']}'); }
    </style>
  </head>
  <body>
  </body>
  </html>
  `;
}

function jsCssErr(message, bgcolor) {
  const rule = errRule(message, bgcolor);
  return `
  var uri = "\\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 630 630'%3e%3cpath fill='%23f7df1e' d='M0 0h630v630H0z'/%3e%3cpath d='M423.2 492.19c12.69 20.72 29.2 35.95 58.4 35.95 24.53 0 40.2-12.26 40.2-29.2 0-20.3-16.1-27.49-43.1-39.3l-14.8-6.35c-42.72-18.2-71.1-41-71.1-89.2 0-44.4 33.83-78.2 86.7-78.2 37.64 0 64.7 13.1 84.2 47.4l-46.1 29.6c-10.15-18.2-21.1-25.37-38.1-25.37-17.34 0-28.33 11-28.33 25.37 0 17.76 11 24.95 36.4 35.95l14.8 6.34c50.3 21.57 78.7 43.56 78.7 93 0 53.3-41.87 82.5-98.1 82.5-54.98 0-90.5-26.2-107.88-60.54zm-209.13 5.13c9.3 16.5 17.76 30.45 38.1 30.45 19.45 0 31.72-7.61 31.72-37.2v-201.3h59.2v202.1c0 61.3-35.94 89.2-88.4 89.2-47.4 0-74.85-24.53-88.81-54.075z'/%3e%3c/svg%3e\\"";
  var style = document.createElement('style');
  style.appendChild(document.createTextNode(''));
  document.head.appendChild(style);
  if ("insertRule" in style.sheet) { style.sheet.insertRule("html:before {${rule} background-image: url("+uri+"); }", 0); }
  else if ("addRule" in style.sheet) { style.sheet.addRule("html:before", "${rule} background-image: url("+uri+"); ", 0); }
  `;
}

module.exports = {
  cssEsc,
  cssErr,
  jsCssErr,
  htmlCssErr
};
